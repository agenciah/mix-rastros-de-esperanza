# fly.toml app configuration file for a Node.js Express app

app = 'hasta-encontrarte-backend'
primary_region = 'dfw'

[build]
  # Usa el constructor est√°ndar y m√°s fiable de Fly.io
  builder = "paketobuildpacks/builder:base"

# Define el servicio web principal
[http_service]
  internal_port = 3000 # El puerto que tu app usa internamente
  force_https = true
  auto_stop_machines = true # Se apaga si no hay tr√°fico para ahorrar recursos
  auto_start_machines = true # Se enciende autom√°ticamente con el primer request
  min_machines_running = 0 # T√≠pico del plan gratuito

# Define c√≥mo el mundo exterior se conecta a tu app
[[services]]
  protocol = "tcp"
  internal_port = 3000
  processes = ["app"]

  [[services.ports]]
    port = 80
    handlers = ["http"]
    force_https = true

  [[services.ports]]
    port = 443
    handlers = ["tls", "http"]

  [services.concurrency]
    type = "connections"
    hard_limit = 25
    soft_limit = 20

  # ‚úÖ LA SECCI√ìN M√ÅS IMPORTANTE: El "Chequeo de Salud"
  # Le dice a Fly.io c√≥mo saber si tu app est√° funcionando.
  [[services.http_checks]]
    interval = "15s" # Cada 15 segundos
    timeout = "2s"
    method = "GET"
    path = "/" # Llama a tu ruta principal (la que responde "Hasta Encontrarte API funcionando üöÄ")
    grace_period = "10s" # Dale a tu app 10s para arrancar antes del primer chequeo